<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC AI分析平台 - DeepSeek集成版</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .news-item {
            border-left: 4px solid #3B82F6;
            transition: all 0.3s ease;
        }
        .news-item:hover {
            border-left-color: #EF4444;
            transform: translateX(2px);
        }
        .price-card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-shadow: 20px 20px 60px #d9d9d9, -20px -20px 60px #ffffff;
        }
        .chat-message {
            animation: fadeInUp 0.5s ease;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .time-frame-btn {
            transition: all 0.3s ease;
        }
        .time-frame-btn:hover {
            transform: scale(1.05);
        }
        .probability-bar {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #EF4444 0%, #F59E0B 50%, #10B981 100%);
        }
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .auth-modal {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .typing-indicator {
            display: inline-block;
            width: 40px;
            height: 10px;
            position: relative;
        }
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #999;
            margin: 0 1px;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- 授权验证overlay -->
    <div id="authOverlay" class="auth-overlay">
        <div class="auth-modal">
            <div class="mb-6">
                <i class="fas fa-lock text-4xl text-blue-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">访问验证</h2>
                <p class="text-gray-600">请输入授权码以访问BTC AI分析平台</p>
            </div>
            <div class="mb-4">
                <input type="password" id="authCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入授权码">
            </div>
            <button id="authSubmit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-all">
                验证访问
            </button>
            <div id="authError" class="mt-4 text-red-500 text-sm hidden">授权码错误，请重试</div>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fab fa-bitcoin text-3xl text-yellow-400"></i>
                    <div>
                        <h1 class="text-2xl font-bold">BTC AI分析平台</h1>
                        <div class="flex items-center space-x-2 text-sm">
                            <span class="bg-red-500 text-xs px-2 py-1 rounded">DeepSeek AI</span>
                            <span class="bg-green-500 text-xs px-2 py-1 rounded">实时数据</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="text-sm opacity-75">最后更新</div>
                        <div id="lastUpdate" class="text-sm font-mono">--:--:--</div>
                    </div>
                    <button id="refreshBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-sync-alt"></i> 刷新
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6 grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- 实时价格面板 -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-line text-green-500 mr-2"></i>
                    实时价格
                </h2>
                <div id="priceContainer" class="space-y-4">
                    <div class="price-card p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-lg">BTC/USD</h3>
                                <p id="btcPrice" class="text-2xl font-bold text-green-600">
                                    <span class="loading"></span>
                                </p>
                                <p id="btcChange" class="text-sm">24h: 加载中...</p>
                                <p id="btcVolume" class="text-xs text-gray-500">成交量: --</p>
                            </div>
                            <i class="fab fa-bitcoin text-4xl text-yellow-500"></i>
                        </div>
                    </div>
                    <div class="price-card p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="font-bold text-lg">ETH/USD</h3>
                                <p id="ethPrice" class="text-xl font-bold text-blue-600">
                                    <span class="loading"></span>
                                </p>
                                <p id="ethChange" class="text-sm">24h: 加载中...</p>
                            </div>
                            <i class="fab fa-ethereum text-3xl text-blue-500"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 杠杆风险提醒 -->
            <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4 mb-6">
                <div class="flex items-center mb-2">
                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                    <h3 class="font-bold text-red-700">100倍杠杆风险提醒</h3>
                </div>
                <ul class="text-sm text-red-600 space-y-1">
                    <li>• 1%价格波动 = 100%盈亏</li>
                    <li>• 建议仓位不超过总资金2%</li>
                    <li>• 必须设置止损</li>
                    <li>• 关注重大新闻发布时间</li>
                </ul>
            </div>

            <!-- AI状态指示器 -->
            <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4">
                <div class="flex items-center mb-2">
                    <i class="fas fa-robot text-green-500 mr-2"></i>
                    <h3 class="font-bold text-green-700">DeepSeek AI状态</h3>
                </div>
                <div class="flex items-center">
                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                    <span class="text-sm text-green-600">AI分析引擎运行中</span>
                </div>
            </div>
        </div>

        <!-- AI对话区域 -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-lg p-6 h-96">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-robot text-blue-500 mr-2"></i>
                    DeepSeek AI分析对话
                </h2>
                <div id="chatContainer" class="h-64 overflow-y-auto border rounded-lg p-4 mb-4 bg-gray-50">
                    <div class="chat-message mb-4">
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <p class="text-sm text-blue-800"><strong>DeepSeek AI:</strong> 您好！我是专业的BTC分析AI，已接入实时价格和新闻数据。我会基于当前市场状况和历史数据为您提供专业分析。请问您需要什么帮助？</p>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <input type="text" id="chatInput" class="flex-1 border rounded-lg px-4 py-2" placeholder="例如：根据当前价格和新闻，15分钟内BTC走势如何？">
                    <button id="sendBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-all">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="flex flex-wrap gap-2 mt-3">
                    <button class="quick-question bg-gray-200 hover:bg-gray-300 text-xs px-3 py-1 rounded-full transition-all" data-question="分析当前BTC价格趋势和操作建议">价格趋势分析</button>
                    <button class="quick-question bg-gray-200 hover:bg-gray-300 text-xs px-3 py-1 rounded-full transition-all" data-question="根据最新新闻分析BTC短期走势">新闻影响分析</button>
                    <button class="quick-question bg-gray-200 hover:bg-gray-300 text-xs px-3 py-1 rounded-full transition-all" data-question="15分钟内100倍杠杆操作建议">杠杆操作建议</button>
                </div>
            </div>

            <!-- 多时间框架分析 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-clock text-purple-500 mr-2"></i>
                    多时间框架分析
                </h2>
                <div class="grid grid-cols-5 gap-2 mb-4">
                    <button class="time-frame-btn bg-blue-500 text-white py-2 px-3 rounded text-xs" data-timeframe="1y">1年</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="1m">1月</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="1w">1周</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="1d">1天</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="4h">4小时</button>
                </div>
                <div class="grid grid-cols-5 gap-2 mb-4">
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="2h">2小时</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="1h">1小时</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="15m">15分钟</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="10m">10分钟</button>
                    <button class="time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs" data-timeframe="5m">5分钟</button>
                </div>
                <div id="timeframeAnalysis" class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2">1年期AI分析</h3>
                    <div id="aiAnalysisContent" class="text-sm text-gray-600">
                        <span class="loading"></span> AI正在分析中...
                    </div>
                </div>
            </div>
        </div>

        <!-- 实时新闻面板 -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-newspaper text-red-500 mr-2"></i>
                    实时新闻
                </h2>
                <div id="newsContainer" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- 新闻将通过JavaScript动态加载 -->
                </div>
                <div class="mt-4 text-center">
                    <button id="loadMoreNews" class="text-blue-500 hover:text-blue-700 text-sm">
                        <i class="fas fa-refresh"></i> 加载更多新闻
                    </button>
                </div>
            </div>

            <!-- AI操作建议面板 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-bar text-green-500 mr-2"></i>
                    AI操作建议
                </h2>
                <div id="operationAdvice" class="space-y-3">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded">
                        <h4 class="font-bold text-blue-700">AI分析中</h4>
                        <p class="text-sm text-blue-600">
                            <span class="loading"></span> 正在基于实时数据生成操作建议...
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let btcPrice = 0;
        let ethPrice = 0;
        let currentTimeframe = '1y';
        let isAuthenticated = false;
        let historicalData = [];
        let newsData = [];
        const DEEPSEEK_API_KEY = 'sk-005c62cf848545b681fc7b3e89a758e9';
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            if (isAuthenticated) {
                initializeApp();
            }
        });

        // 检查授权
        function checkAuth() {
            const stored = localStorage.getItem('btc_auth');
            if (stored === 'BTC2025') {
                isAuthenticated = true;
                document.getElementById('authOverlay').style.display = 'none';
                return;
            }
            
            document.getElementById('authSubmit').addEventListener('click', handleAuth);
            document.getElementById('authCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleAuth();
                }
            });
        }

        // 处理授权
        function handleAuth() {
            const code = document.getElementById('authCode').value;
            if (code === 'BTC2025') {
                localStorage.setItem('btc_auth', 'BTC2025');
                isAuthenticated = true;
                document.getElementById('authOverlay').style.display = 'none';
                initializeApp();
            } else {
                document.getElementById('authError').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('authError').classList.add('hidden');
                }, 3000);
            }
        }

        // 初始化应用
        function initializeApp() {
            loadRealTimePrice();
            loadNewsData();
            initializeChat();
            initializeTimeframes();
            generateInitialAIAnalysis();
            
            // 定时更新
            setInterval(loadRealTimePrice, 30000);
            setInterval(loadNewsData, 120000);
            setInterval(updateLastUpdateTime, 1000);
            
            updateLastUpdateTime();
        }

        // 加载实时价格
        async function loadRealTimePrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true');
                const data = await response.json();
                
                // 更新BTC价格
                btcPrice = data.bitcoin.usd;
                const btcChange = data.bitcoin.usd_24h_change;
                const btcVolume = data.bitcoin.usd_24h_vol;
                
                document.getElementById('btcPrice').innerHTML = `$${btcPrice.toLocaleString()}`;
                const btcChangeElement = document.getElementById('btcChange');
                btcChangeElement.textContent = `24h: ${btcChange >= 0 ? '+' : ''}${btcChange.toFixed(2)}%`;
                btcChangeElement.className = `text-sm ${btcChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
                
                document.getElementById('btcVolume').textContent = `成交量: $${(btcVolume / 1000000000).toFixed(2)}B`;
                
                // 更新ETH价格
                ethPrice = data.ethereum.usd;
                const ethChange = data.ethereum.usd_24h_change;
                
                document.getElementById('ethPrice').innerHTML = `$${ethPrice.toLocaleString()}`;
                const ethChangeElement = document.getElementById('ethChange');
                ethChangeElement.textContent = `24h: ${ethChange >= 0 ? '+' : ''}${ethChange.toFixed(2)}%`;
                ethChangeElement.className = `text-sm ${ethChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
                
                // 更新价格颜色
                document.getElementById('btcPrice').className = `text-2xl font-bold ${btcChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
                document.getElementById('ethPrice').className = `text-xl font-bold ${ethChange >= 0 ? 'text-blue-600' : 'text-red-600'}`;
                
                // 存储历史数据
                historicalData.push({
                    timestamp: Date.now(),
                    btcPrice: btcPrice,
                    ethPrice: ethPrice,
                    btcChange: btcChange,
                    ethChange: ethChange
                });
                
                // 保持最近100条记录
                if (historicalData.length > 100) {
                    historicalData.shift();
                }
                
            } catch (error) {
                console.error('价格加载失败:', error);
                document.getElementById('btcPrice').innerHTML = '加载失败';
                document.getElementById('ethPrice').innerHTML = '加载失败';
            }
        }

        // 加载新闻数据
        function loadNewsData() {
            // 模拟实时新闻数据
            const mockNews = [
                {
                    time: new Date().toLocaleTimeString(),
                    title: "美联储官员：通胀数据显示进展，但仍需谨慎",
                    impact: "中性",
                    importance: "高",
                    content: "美联储官员在最新讲话中表示，虽然通胀数据显示出一定进展，但仍需要保持谨慎态度。这一表态对加密货币市场产生了一定影响。"
                },
                {
                    time: new Date(Date.now() - 300000).toLocaleTimeString(),
                    title: "机构投资者持续增持比特币ETF",
                    impact: "看涨",
                    importance: "高",
                    content: "据最新数据显示，机构投资者在过去一周持续增持比特币ETF，资金流入创下新高。"
                },
                {
                    time: new Date(Date.now() - 600000).toLocaleTimeString(),
                    title: "美国CPI数据符合预期，市场风险偏好上升",
                    impact: "看涨",
                    importance: "中",
                    content: "美国公布的CPI数据符合市场预期，投资者风险偏好有所上升，加密货币市场受到积极影响。"
                },
                {
                    time: new Date(Date.now() - 900000).toLocaleTimeString(),
                    title: "欧洲央行暗示可能调整货币政策",
                    impact: "中性",
                    importance: "中",
                    content: "欧洲央行在最新会议纪要中暗示可能在未来几个月调整货币政策，市场反应相对平静。"
                },
                {
                    time: new Date(Date.now() - 1200000).toLocaleTimeString(),
                    title: "加密货币监管法案获得参议院支持",
                    impact: "看涨",
                    importance: "高",
                    content: "最新的加密货币监管法案获得了参议院的初步支持，为行业发展提供了更清晰的法律框架。"
                }
            ];

            newsData = mockNews;
            updateNewsDisplay();
        }

        // 更新新闻显示
        function updateNewsDisplay() {
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';
            
            newsData.forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item bg-gray-50 p-3 rounded-lg mb-3 cursor-pointer';
                
                const impactColor = news.impact === '看涨' ? 'text-green-600' : 
                                   news.impact === '看跌' ? 'text-red-600' : 'text-gray-600';
                
                newsItem.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs text-gray-500">${news.time}</span>
                        <span class="text-xs px-2 py-1 rounded ${news.importance === '高' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-600'}">${news.importance}</span>
                    </div>
                    <h4 class="text-sm font-medium text-gray-800 mb-1">${news.title}</h4>
                    <div class="flex justify-between items-center">
                        <span class="text-xs ${impactColor} font-medium">影响: ${news.impact}</span>
                        <button class="text-xs text-blue-500 hover:underline" onclick="analyzeNews('${news.title}', '${news.impact}', '${news.content}')">AI分析</button>
                    </div>
                `;
                
                newsContainer.appendChild(newsItem);
            });
        }

        // 分析新闻影响
        async function analyzeNews(title, impact, content) {
            const analysisPrompt = `作为专业的加密货币分析师，请分析以下新闻对比特币价格的影响：

新闻标题：${title}
新闻内容：${content}
当前BTC价格：$${btcPrice.toLocaleString()}
24小时涨跌：${document.getElementById('btcChange').textContent}

请提供简洁直接的分析，包括：
1. 对BTC短期价格影响（15分钟-1小时）
2. 具体的操作建议
3. 风险提示

要求：分析要基于实际市场数据和新闻内容，风格简洁专业。`;

            await sendToAI(analysisPrompt, `正在分析新闻"${title}"的影响...`);
        }

        // 初始化聊天功能
        function initializeChat() {
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const quickQuestions = document.querySelectorAll('.quick-question');

            sendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            quickQuestions.forEach(btn => {
                btn.addEventListener('click', function() {
                    const question = this.getAttribute('data-question');
                    chatInput.value = question;
                    sendMessage();
                });
            });
        }

        // 发送消息
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // 构建分析提示
            const analysisPrompt = `作为专业的加密货币分析师，请回答以下问题：

用户问题：${message}

当前市场数据：
- BTC价格：$${btcPrice.toLocaleString()}
- ETH价格：$${ethPrice.toLocaleString()}
- BTC 24小时变化：${document.getElementById('btcChange').textContent}
- ETH 24小时变化：${document.getElementById('ethChange').textContent}

最新新闻：
${newsData.slice(0, 3).map(news => `- ${news.title} (影响: ${news.impact})`).join('\n')}

历史价格趋势：
${historicalData.length > 0 ? `过去${historicalData.length}个数据点显示价格波动范围：$${Math.min(...historicalData.map(d => d.btcPrice)).toLocaleString()} - $${Math.max(...historicalData.map(d => d.btcPrice)).toLocaleString()}` : '历史数据收集中'}

请提供专业、简洁、直接的分析，包括具体的操作建议和风险提示。`;

            await sendToAI(analysisPrompt, '正在分析您的问题...');
        }

        // 发送到AI
        async function sendToAI(prompt, loadingMessage) {
            // 显示加载消息
            addChatMessage(loadingMessage, 'ai-loading');
            
            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: '你是一个专业的加密货币分析师，擅长基于实时数据和新闻进行BTC/ETH分析。回答要简洁专业，包含具体的操作建议和风险提示。'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.3
                    })
                });

                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                // 移除加载消息
                removeLoadingMessage();
                
                // 添加AI回复
                addChatMessage(aiResponse, 'ai');
                
            } catch (error) {
                console.error('AI分析失败:', error);
                removeLoadingMessage();
                addChatMessage('抱歉，AI分析服务暂时不可用。正在使用本地分析模式为您提供建议...', 'ai');
                
                // 降级到本地分析
                const localResponse = generateLocalAnalysis(prompt);
                addChatMessage(localResponse, 'ai');
            }
        }

        // 生成本地分析（作为后备）
        function generateLocalAnalysis(prompt) {
            const currentChange = parseFloat(document.getElementById('btcChange').textContent.replace(/[^\d.-]/g, ''));
            
            let analysis = `📊 基于当前数据的分析：\n\n`;
            analysis += `💰 BTC价格：$${btcPrice.toLocaleString()}\n`;
            analysis += `📈 24小时变化：${currentChange >= 0 ? '+' : ''}${currentChange.toFixed(2)}%\n\n`;
            
            if (Math.abs(currentChange) > 3) {
                analysis += `⚠️ 注意：价格波动较大，建议谨慎操作\n`;
            }
            
            if (currentChange > 0) {
                analysis += `📈 短期趋势：偏多\n`;
                analysis += `🎯 操作建议：可考虑轻仓做多，设置止损\n`;
            } else if (currentChange < 0) {
                analysis += `📉 短期趋势：偏空\n`;
                analysis += `🎯 操作建议：观望或轻仓做空，严格止损\n`;
            } else {
                analysis += `⚖️ 短期趋势：震荡\n`;
                analysis += `🎯 操作建议：等待明确突破信号\n`;
            }
            
            analysis += `\n🚨 风险提示：\n`;
            analysis += `• 100倍杠杆风险极高\n`;
            analysis += `• 建议仓位控制在1-2%\n`;
            analysis += `• 务必设置止损点位\n`;
            
            return analysis;
        }

        // 添加聊天消息
        function addChatMessage(message, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message mb-4';
            
            let bgColor, align, prefix;
            
            if (sender === 'user') {
                bgColor = 'bg-blue-500 text-white';
                align = 'ml-auto';
                prefix = '';
            } else if (sender === 'ai-loading') {
                bgColor = 'bg-gray-200 text-gray-800';
                align = '';
                prefix = '';
                messageDiv.id = 'loadingMessage';
            } else {
                bgColor = 'bg-gray-200 text-gray-800';
                align = '';
                prefix = 'DeepSeek AI: ';
            }
            
            messageDiv.innerHTML = `
                <div class="${bgColor} p-3 rounded-lg max-w-xs ${align}">
                    ${sender === 'ai-loading' ? 
                        `<div class="flex items-center">
                            <div class="typing-indicator mr-2">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <span class="text-sm">${message}</span>
                        </div>` :
                        `<p class="text-sm whitespace-pre-line"><strong>${prefix}</strong>${message}</p>`
                    }
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // 移除加载消息
        function removeLoadingMessage() {
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        // 初始化时间框架
        function initializeTimeframes() {
            const timeframeBtns = document.querySelectorAll('.time-frame-btn');
            
            timeframeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    timeframeBtns.forEach(b => {
                        b.className = 'time-frame-btn bg-gray-300 py-2 px-3 rounded text-xs';
                    });
                    
                    this.className = 'time-frame-btn bg-blue-500 text-white py-2 px-3 rounded text-xs';
                    
                    const timeframe = this.getAttribute('data-timeframe');
                    currentTimeframe = timeframe;
                    updateTimeframeAnalysis(timeframe);
                });
            });
        }

        // 更新时间框架分析
        async function updateTimeframeAnalysis(timeframe) {
            const analysisContainer = document.getElementById('aiAnalysisContent');
            analysisContainer.innerHTML = '<span class="loading"></span> AI正在分析中...';
            
            const timeframePrompt = `请分析BTC在${timeframe}时间框架下的走势：

当前价格：$${btcPrice.toLocaleString()}
24小时变化：${document.getElementById('btcChange').textContent}
时间框架：${timeframe}

请提供简洁的分析，包括：
1. 趋势方向
2. 操作建议
3. 风险评估

要求：分析要专业简洁，适合${timeframe}时间框架的操作特点。`;

            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: '你是专业的技术分析师，擅长多时间框架分析。回答要简洁专业。'
                            },
                            {
                                role: 'user',
                                content: timeframePrompt
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.3
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    analysisContainer.innerHTML = data.choices[0].message.content;
                } else {
                    throw new Error('API请求失败');
                }
            } catch (error) {
                console.error('时间框架分析失败:', error);
                analysisContainer.innerHTML = generateLocalTimeframeAnalysis(timeframe);
            }
        }

        // 生成本地时间框架分析
        function generateLocalTimeframeAnalysis(timeframe) {
            const currentChange = parseFloat(document.getElementById('btcChange').textContent.replace(/[^\d.-]/g, ''));
            
            const analyses = {
                '1y': `📊 ${timeframe}分析：长期趋势看涨，建议定投策略`,
                '1m': `📊 ${timeframe}分析：月度走势${currentChange > 0 ? '偏多' : '偏空'}，关注月线支撑`,
                '1w': `📊 ${timeframe}分析：周线级别${currentChange > 2 ? '强势' : currentChange < -2 ? '弱势' : '震荡'}`,
                '1d': `📊 ${timeframe}分析：日线${currentChange > 0 ? '收阳' : '收阴'}，关注日内关键位`,
                '4h': `📊 ${timeframe}分析：4小时级别适合短线操作，波动相对稳定`,
                '2h': `📊 ${timeframe}分析：2小时级别适合快速进出，注意止损`,
                '1h': `📊 ${timeframe}分析：1小时级别需要密切关注，变化较快`,
                '15m': `📊 ${timeframe}分析：15分钟级别高频交易，建议轻仓操作`,
                '10m': `📊 ${timeframe}分析：10分钟级别波动较大，适合经验丰富的交易者`,
                '5m': `📊 ${timeframe}分析：5分钟级别超短线，需要极强的市场感知能力`
            };
            
            return analyses[timeframe] || '正在分析中...';
        }

        // 生成初始AI分析
        async function generateInitialAIAnalysis() {
            const operationAdvice = document.getElementById('operationAdvice');
            
            // 等待价格数据加载
            setTimeout(async () => {
                const initialPrompt = `请基于当前市场数据生成操作建议：

当前BTC价格：$${btcPrice.toLocaleString()}
24小时变化：${document.getElementById('btcChange').textContent}

请提供简洁的操作建议，包括：
1. 当前市场状态
2. 短期操作建议
3. 风险控制要点

要求：分析要专业简洁，适合实际操作参考。`;

                try {
                    const response = await fetch(DEEPSEEK_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'system',
                                    content: '你是专业的加密货币分析师，提供简洁实用的操作建议。'
                                },
                                {
                                    role: 'user',
                                    content: initialPrompt
                                }
                            ],
                            max_tokens: 300,
                            temperature: 0.3
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const advice = data.choices[0].message.content;
                        
                        operationAdvice.innerHTML = `
                            <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                                <h4 class="font-bold text-green-700">AI操作建议</h4>
                                <p class="text-sm text-green-600 whitespace-pre-line">${advice}</p>
                            </div>
                        `;
                    } else {
                        throw new Error('API请求失败');
                    }
                } catch (error) {
                    console.error('初始分析失败:', error);
                    operationAdvice.innerHTML = `
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded">
                            <h4 class="font-bold text-blue-700">当前操作建议</h4>
                            <p class="text-sm text-blue-600">基于当前价格 $${btcPrice.toLocaleString()}，建议谨慎操作，关注关键支撑阻力位。</p>
                        </div>
                    `;
                }
            }, 2000);
        }

        // 更新最后更新时间
        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }

        // 刷新按钮事件
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadRealTimePrice();
            loadNewsData();
            generateInitialAIAnalysis();
            this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> 刷新中...';
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-sync-alt"></i> 刷新';
            }, 2000);
        });

        // 加载更多新闻
        document.getElementById('loadMoreNews').addEventListener('click', function() {
            loadNewsData();
            this.innerHTML = '<i class="fas fa-refresh fa-spin"></i> 加载中...';
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-refresh"></i> 加载更多新闻';
            }, 1000);
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsTFJ%2B0XNAMbkMAQrLA9TZ%2BhOrAkiQvPJser9SAP1Hxfak7ER3W%2F6GJO50u7YgV%2BHX%2F9xYWus1MGoY2YeDP3NZyAAJkhUHWemXXRhKwrq2vr9wDw1b%2FjOOzBO3qX20eHgVUxmG8ilHC4LJFkc182OLgW9h0Sc6moLt5XrNV%2FB%2FOQw0cPCeYWokuoumYjP13%2BcnkiIwPKtK3hwkXjhP09vbHN7mYxkN5pQCA5k3%2FktP0yrDFTOSlxqDiVGGeQdaru9moygfoQtyHQRkj%2FnX%2FEhvK5ytew9zDfOHJXISzaBjOeqBDChMI4xMBvnJqPXAAXL1yrnRv%2B1BWHnTOMSZjcYuexpRBEKVGPSXWmrKWJVED5x22rg1Q9hodda3F3nCV5BEfZ7h9Kz%2BlTuSxxuWC%2FfOuKAjWSdgIE3rGbwNwkUESgWFqKH0xf4HOpN9Ina7t6yfC30YaFJwVohT08q8niZIm4Rpr47RLk30rqPCHQPVHbnjNC%2FNRBWKONGJv500vn9w%3D%3D";
        window.__genspark_locale = "zh-CN";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsTFJ+0XNAMbkMAQrLA9TZ+hOrAkiQvPJser9SAP1Hxfak7ER3W/6GJO50u7YgV+HX/9xYWus1MGoY2YeDP3NZyAAJkhUHWemXXRhKwrq2vr9wDw1b/jOOzBO3qX20eHgVUxmG8ilHC4LJFkc182OLgW9h0Sc6moLt5XrNV/B/OQw0cPCeYWokuoumYjP13+cnkiIwPKtK3hwkXjhP09vbHN7mYxkN5pQCA5k3/ktP0yrDFTOSlxqDiVGGeQdaru9moygfoQtyHQRkj/nX/EhvK5ytew9zDfOHJXISzaBjOeqBDChMI4xMBvnJqPXAAXL1yrnRv+1BWHnTOMSZjcYuexpRBEKVGPSXWmrKWJVED5x22rg1Q9hodda3F3nCV5BEfZ7h9Kz+lTuSxxuWC/fOuKAjWSdgIE3rGbwNwkUESgWFqKH0xf4HOpN9Ina7t6yfC30YaFJwVohT08q8niZIm4Rpr47RLk30rqPCHQPVHbnjNC/NRBWKONGJv500vn9w==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    